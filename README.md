# RTPlayer

[Скачать последнюю версию](https://github.com/rbwsok/RTPlayer/releases)

Музыкальный плеер для Chery Tiggo 7 Pro Max. Работает на нативном андроиде. Не через Android Auto!!! Устанавливается через adb. Можно устанавливать через ADB AppControl. Как получить доступ к adb - читаем на drive2.

Плеер будет работать и на других устройствах, но в данный момент затачивается только под экран и особенности Chery Tiggo. 

### Возможности:
- проигрывание mp3 файлов
- поддержка штатных кнопок на руле
- обработка внешних событий, влияющих на звук (включение заднего ходаб уведомление от навигации и т.д.)
- регулировка пустого пространоства (сжимание рабочей области) - чтобы от нажатий на краях экрана не вызывались системные окна (например управление климатом)
- встроенный FTP сервер для закачивания музыки с телефона или ПК (необходима активация WiFi в инженерном меню)
- внешний вид в стиле стандартных приложений (с возможностью переключения "только рабочая область"/"полный экран")

### Особенности штатной магнитолы и андроида Chery Tiggo 7 Pro Max (а так же 8 Pro Max и Arrizo 8)
- Android 9 (API Level 28)
- Андроид работает в виртуальной машине. Хостовя ось - QNX 7.
- Не очень быстрый процессор Renesas G6SH (2 Cortex A57 и 2 Cortex A53 в big-little)
- Полное разрешение 1920x720. Рабочая область 1460x720.
- Очень неудобный штатный плеер
- Отсутствие кнопки "назад". Физической и виртуальной.
- Отсутствие стандартных настроек, возможности управления приложениями и их правами
- Нестандартные и очень странные размеры и положения тулбаров.
- Клик или свайп на границах экрана вызывает штатные окна.
  
### Причины написания своего плеера с блекждекои и куртизанками...

#### 1. Неудобный штатный плеер.

Штатный плеер музыки из папок на Tiggo 7 Pro Max выглядит красиво, но по функционалу очень слаб. В частности все mp3 файлы засовывает в один список. Также после старта надо совершить несколько щелчков для воспроизведения музыки. Никакой каталогизации или библиотеки.

#### 2. Переключение юзер кейсов.

RTPlayer реализует два user case:
1. Проигрывание музыки по альбомам, композиция за композицией.
2. Случайное воспроизведение композиций из одной папки.

В частности - я люблю слушать по первому кейсу - один исполнитель, один альбом. А супруга такое не любит. Ей надо чтобы каждый раз была новая случайная песня. При чем репертуар пересекается примерно на 2/3. Из за этого моя музыка разложена по папкам, а ее - свалена в одну.

В режиме случайного воспроизведения, подрулевые кнопки "вперед" и "назад" работают одинакого и переходят на случайную композицию.

#### 3. Выезжающие штатные окна.

Сжатие рабочей области позволяет в какой то мере решить эту проблему. Т.е. края экрана просто остаются пустыми. 

#### 4. FTP Сервер.

Позволяет закачивать музыку по воздуху. Не работает постоянно!!! Запускается только при ручном запуске пользователем.

Для работы нужен wifi. Обычно wifi настраивается на автоматическое подключение к точки доступа, например в телефоне. В этом случае с телефона становится доступен линк до плеера. Также можно подключить к той же точке доступа ПК и заходить в плеер с него.

Нужен любой FTP клиент. IP Адреса выводятся на экран. Надо пробовать все. 192.168.2.2 - это вроде бы зашитый адрес для общения с хостовой операционной системой.

Пароль - любое слово. Проверок нет!!!

Тестировался Total Commander для Windows и Total Commander c FTP плагином для Android. Если не подключается - то надо снять или поставить галку "пассивный режим". Положение этой настройки для TotalCommander для Windows и Android отличается.

### Тестирование

Прошивка 2.03 для 7ПМ.
Тестировалось в поездке на дальняк в паре с навигацией и в многочисленных поездках по городу.

### TODO. Что еще предстоит сделать
- Вынести в параллельный поток считывание информации о композициях. Сейчас может подтормаживать при резком скролле на больших количествах файлов.
- Сделать имитацию штатных софтовых кнопок.
- Доработать режим повторения "все звуки" т.к. сейчас работает криво.
- Сделать автозагрузку. (скорее всего это невозможно на данном ГУ).
- Сделать ремаппер подрулевых клавиш с подавлением штатных функций. (или сделать это сторонним софтом). Сейчас ремаппер НЕ работает. Есть только его настройка.
- Сделать подавление изображения штатного голосового помошника. (Не уверен что возможно).
- Убрать переключение fullscreen отображения при изменении настроек.

### Сторонний код и ресурсы

Для реализации FTP была взята библиотека MinimalFTP - https://github.com/Guichaguri/MinimalFTP

