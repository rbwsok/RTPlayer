# RTPlayer

[Скачать последнюю версию](https://github.com/rbwsok/RTPlayer/releases)

Музыкальный плеер для Chery Tiggo 7 Pro Max. Работает на нативном андроиде. Не через Android Auto!!! Устанавливается через adb. Можно устанавливать через ADB AppControl. Как получить доступ к adb - читаем на drive2.

Плеер будет работать и на других устройствах, но в данный момент затачивается только под экран и особенности Chery Tiggo. 

![Главное окно](https://github.com/rbwsok/RTPlayer/blob/main/doc/main.jpg)

### Возможности:
- проигрывание mp3 файлов.
- поддержка штатных кнопок на руле (Next И Prev).
- обработка внешних событий, влияющих на звук (включение заднего хода, уведомление от навигации и т.д.).
- регулировка пустого пространства (сжимание рабочей области) - чтобы от нажатий на краях экрана не вызывались системные окна (например управление климатом).
- встроенный FTP сервер для закачивания музыки с телефона или ПК (необходима активация WiFi в инженерном меню ГУ).
- изображение фона - стандартные бекграунды для трех тем. По 2 изображения на тему.

![classic 1](https://github.com/rbwsok/RTPlayer/blob/main/doc/background_classic_1_320.jpg)
![classic 2](https://github.com/rbwsok/RTPlayer/blob/main/doc/background_classic_2_320.jpg)

![stream 1](https://github.com/rbwsok/RTPlayer/blob/main/doc/background_stream_1_320.jpg)
![stream 2](https://github.com/rbwsok/RTPlayer/blob/main/doc/background_stream_2_320.jpg)

![style 1](https://github.com/rbwsok/RTPlayer/blob/main/doc/background_style_1_320.jpg)
![style 2](https://github.com/rbwsok/RTPlayer/blob/main/doc/background_style_2_320.jpg)

- регулировка размера текста на главном экране.
- работа с двумя usb накопителями.
- поддержка интернет радиостанций, браузер через сервис (https://www.radio-browser.info).
- поддержка избранных радиостанций.

### Особенности штатной магнитолы и андроида Chery Tiggo 7 Pro Max (а так же 8 Pro Max и Arrizo 8)
- Android 9 (API Level 28).
- Андроид работает в виртуальной машине. Хостовя ось - QNX 7.
- Не очень быстрый процессор Renesas G6SH (2 Cortex A57 и 2 Cortex A53 в big-little).
- Полное разрешение 1920x720. Диагональ 12.3 дюйма.
- Navigation Bar слева 288. System Bar справа - 96. Рабочая область 1920 - 288 - 96 = 1536.
- Часть Navigation Bar с кнопками - 180. Вторая часть (108) никак не используется.
- Очень неудобный штатный плеер.
- Отсутствие кнопки "назад". Физической и виртуальной.
- Отсутствие стандартных настроек, возможности управления приложениями и их правами. Только через ADB.
- Клик или свайп на границах экрана вызывает штатные окна.
  
### Причины написания своего плеера с блекждеком и куртизанками...

#### 1. Неудобный штатный плеер.

Штатный плеер музыки из папок на Tiggo 7 Pro Max выглядит красиво, но по функционалу очень слаб. В частности все mp3 файлы засовывает в один список. Также после старта надо совершить несколько щелчков для воспроизведения музыки. Никакой каталогизации или библиотеки.

#### 2. Неудобные или неработающие универсальные плееры.

Из за особенностей андроида в ГУ, на нем не работают (вылетают) многие плееры. Заработал AIMP. Но удобным и интуитивно понятным его не назовешь.

#### 3. Переключение юзер кейсов.

RTPlayer реализует три юзер кейса:
1. Проигрывание музыки по альбомам, композиция за композицией.
2. Случайное воспроизведение композиций из одной папки.
3. Избранные радиостанции.

В режиме случайного воспроизведения, рулевые кнопки "вперед" и "назад" работают одинаково и переходят на случайную композицию.

#### 4. Выезжающие штатные окна.

Сжатие рабочей области позволяет в какой то мере решить эту проблему. Т.е. края экрана просто остаются пустыми. В RTPlayer сделана возможность регулировки пустого пространства со всех четырех сторон.

#### 5. FTP Сервер.

Позволяет закачивать музыку по воздуху. Не работает постоянно!!! Запускается только при ручном запуске пользователем.

Для работы нужен wifi. Обычно wifi настраивается на автоматическое подключение к точке доступа, например в телефоне. В этом случае с телефона становится доступен линк до плеера. Также можно подключить к той же точке доступа ПК и заходить в плеер с него.

Нужен любой FTP клиент. IP адреса выводятся на экран. Надо пробовать все. 

Можно попробовать пинговать. Если есть пинг - то и по ftp подключится.

Пароль - любое слово. Проверок нет.

Тестировался Total Commander для Windows и Total Commander c FTP плагином для Android. Если не подключается - то надо снять или поставить галку "пассивный режим". Положение этой настройки для TotalCommander для Windows и Android отличается.

Корневая папка для FTP - это "Папка с музыкой" в настройках плеера.

#### 6. Интернет радио.

Поддержка интернет радио была сделана скорее по принципу "а почему бы и нет?".
Серьезный функционал не закладывался и скорее всего вряд ли будет развиваться дальше.

Для формирования списка радиостанций взят сервис https://www.radio-browser.info
Он содержит огромное количество радиостанций на разных языках. Приложение использует лиш небольшую часть возможностей сервиса.

### Эргономика.

1. Плеер не должен отвлекать на себя внимание во время движения. Т.е. никаких обложек, анимации, эквалайзеров и прочего.
2. Плеер должен максимально напоминать штатный софт.
3. Плеер должен быть легким в управлении. Включая рулевые клавиши, а также "пианино" под экраном.
4. Чем меньше настроек, тем лучше.

### Тестирование

Прошивка 2.03 для 7ПМ.
Файловый плеер оттестирован довольно неплохо. В том числе и в поездках на дальняк, в фоне и т.д.
Интернет радио тестровалось гораздо меньше из-за ограничений, связаных с отсутствием интернета во многих местах.

### Установка и начало работы.

1. Установить через adb плеер.
2. Вставить флешку с музыкой.
3. Запустить плеер и в настройках в "Папка с музыкой" руками прописать путь. Для 7ПМ, usb накопители на нижней части консоли - это /storage/usb0 и /storage/usb1. Выбора навигацией по папкам нет!
4. Нажать на кнопку "Выход в корневую папку".
Если нужнен второй usb накопитель - то же самое сделать с настройкой "Дополнительная папка с музыкой".

### Кнопки на главном экране.

![Перемещение в корневую папку](https://github.com/rbwsok/RTPlayer/blob/main/doc/root.jpg) - Перемещение в корневую папку

![Перемещение в папку на уровень выше](https://github.com/rbwsok/RTPlayer/blob/main/doc/parent.jpg) - Перемещение в папку на уровень выше

![Настройки](https://github.com/rbwsok/RTPlayer/blob/main/doc/options.jpg) - Настройки

![Перемешивание](https://github.com/rbwsok/RTPlayer/blob/main/doc/shuffle.jpg) - Перемешивание

![Выход](https://github.com/rbwsok/RTPlayer/blob/main/doc/exit.jpg) - Выход (С остановкой процесса)

### TODO. Что еще предстоит сделать

- ~~Вынести в параллельный поток считывание информации о композициях. Сейчас может подтормаживать при резком скролле на больших количествах файлов.~~
- ~~Рабочая навигационная панель (Navigation Bar).~~
- ~~Корректное отображение фона под Navigation Bar.~~
- ~~Доработать режим повторения "все звуки" т.к. сейчас работает криво.~~
- Сделать автозагрузку. (RECEIVE_BOOT_COMPLETED и QUICKBOOT_POWERON не работают).
- Сделать ремаппер рулевых клавиш и "пианино" с подавлением штатных функций. (или сделать это сторонним софтом). Сейчас ремаппер НЕ работает. Есть только его настройка. Ловит рулевые клавиши и две на пианино под ГУ. Проблема в невозможности подавления штатных функций.
- Сделать подавление изображения штатного голосового помощника. (Не уверен что возможно со стороны софта без изменения глобальной конфигурации. Изображение видно даже при установленном SYSTEM_UI_FLAG_IMMERSIVE).
- Сделать передачу информации о проигрываемом файле на приборную панель. (Понятия не имею как, но штатный плеер может)

### Сторонний код и ресурсы

Для реализации FTP была взята библиотека MinimalFTP - https://github.com/Guichaguri/MinimalFTP без каких либо изменений.

Браузер для интернет радиостанций - https://github.com/sfuhrm/radiobrowser4j (https://www.radio-browser.info)

### Лицензия

MIT
